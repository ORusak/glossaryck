# WebRTC
* Стандарт, который описывает передачу потоковых аудиоданных, видеоданных и контента от браузера и к браузеру в режиме реального времени без установки плагинов или иных расширений. Стандарт позволяет превратить браузер в оконечный терминал видеоконференцсвязи.
Включает в себя:
* Подключение камеры и микрофона
* Соединение между клиентами peer to peer (p2p)
* Передача видео и аудио по сети. Анализ ширины канала и подстройка под него битрейта кодека.
* Кодирование и декодирование разными кодеками, которые поддерживает браузер.
* Воспроизведение полученного.
* Передача данных в UDP или TCP стиле.
* Screen Sharing.

## Характеризуется:
* Безопасностью, так как связь идет между конечными клиентами без посредников
* Простотой, не требуется использование дополнительных расширений или плагинов
* Встраиваемостью, для обеспечение связи не требуется использования сторонних программ. Весь функционал является частью веб приложения.
* Масштабируемостью, не для поддержки связи не требуется стороних серверов или посредников.

## Плюсы:
* нет плагинов
* p2p 
* encryption


## Минусы:
* no IE, Safari? Уже есть в каком то виде
* no mobile support? Тоже есть
* масштабирование на несколько пользователей тяжело сделать

## Области применения
* Случаи когда собеседников не много
    * Поддержка на сайте (чат, общение)
    * Телемедицина: приватность, два пользователя
    * Игры: передача данных не влияющих на игровой процесс (чат, позиционирование в игре)
    * Передача файлов

# Понятия, определения
* SDP -
* ICE (Interactive Connectivity Establishment, Интерактивное подключение) - это метод, используемый в компьютерных сетях, чтобы найти способы, позволяющие двум компьютерам общаться друг с другом как можно более непосредственным образом в одноранговой сети. Это чаще всего используется для интерактивных медиа, таких как передача голоса по интернет-протоколу (VoIP), одноранговая связь, видео и обмен мгновенными сообщениями. В таких приложениях вы избегаете общения через центральный сервер (что замедлит общение и будет дорогостоящим), но прямая связь между клиентскими приложениями в Интернете очень сложна из-за сетевых адресов (NAT), брандмауэров и других сетевые барьеры.
* NAT (Network address translation) - 

# Сервера
Требуются для установления p2p связи между клиентами, построения сложной схемы взаимодействия участников, обработки потоков.web, 
## web server
Решение по взаимодействию с пользователем.

Узкое место память (управление пользователями)
## signaling server
Средство коммуникации участников для установки соединения. Обмен SDP, ICE пакетами.
* Реализация: socket, pub/sub.
* Узкое место память (управление пользователями)
* в продакшене лучше не использовать общедоступные. много open source решений.

## turn, stun server
Средства для сложных вариантов соединения между участниками. Когда установка прямых адресов затруднено например firewall.
stun - сервер предназначен для изучения топологии сети выдачи адреса соединения
turn - сервер когда адресат закрыт и прямого доступа к нему нет. За firewall устанавливается turn сервер к которому идет соединение и через котороый идут media потоки.

* Узкое место узкое место сеть (подключения, передача медиа потоков)
* в продакшене лучше не использовать общедоступные. много open source решений.
* Готовые решения:
    * для разворачивания у себя coturn, resturnd
    * сторонние twilio, XirSys, bit6

## media server
 Существуют различные разновидности в зависимости от задач.

### SFU (Media Router) 
Распределяет потоки между участниками. 
* Узкое место сеть.
* решения Jitsi, Kurendo, SwitchRTC, mediaSoup
### MCU (Media Mixer ) 
Собирает потоки от разных участников в один поток и рассылает.
* Узкое место (по порядку) процессор, память, сеть меньше.
### Recording 
Собирает потоки и записывает. 
* Узкое место хранилище. 

# Вопросы
* Как захватывать рабочий стол?
    * Через расширение браузера получить поток.
* Проверить связь через мобильное устройство
* Реализация связи через обмен ссылками. Почему нельзя устроить?
    * Инициатор формирует ссылку со своими данными SDP, ICE (предварительно может использовать STUN сервер)
    * Инициатор ожидает подключения
    * Получатель переходит по ссылке формирует подключение по переданным данным к Инициатору и передает свои данные SDP, ICE
    * Инициатор получает подключение к Получателю
    * Общаются!

# Ресурсы
* Репозиторий 
    * https://github.com/webrtc - организации https://webrtc.org
* Медиа-возможности HTML5. WebRTC  
    * https://www.youtube.com/watch?v=_gZXYjlBfnw
    * https://www.slideshare.net/oelifantiev/webrtc-47460817
    * Захват аудио и видео https://www.html5rocks.com/en/tutorials/getusermedia/intro/
* Курсы
    * Introduction to WebRTC 
    * Материалы https://resources.oreilly.com/examples/0636920040279/
* Библиотеки 
    * Адаптер от google от префиксов вендеров https://github.com/webrtc/adapter

# Web Audio API
* Пример
    * http://webaudioplayground.appspot.com/
* Можно сгенерить свой и отправить
* Можно отправить файл

# Web Video API
* Примеры преобразования
    * https://github.com/idevelop/ascii-camera
    * https://github.com/auduno/headtrackr
* Видео никак не сгенерить, не отправить свое

# Data Transfer API
* Возможность указать стабильность канала (гарантированность доставки), reliable
    * не стабильная быстрей, но могут терятся ппакеты. это приемлимо например для показа рабочего стола
    * стабильная медленней, но поток не портится, что важно при передаче файлов
* API похоже на socket
* В отличии от socket зашифрованное
* Не требует от браузера разрешений
* Отправка файла
    * Отдельная отправка меты файла (имени, размера) через socket
    * Передача через DT частей файла (16к), склейка при получении в буфер, создание файла при окончании из буфера и меты.
    

# Браузеры
## Разрешения
* API не работает со страницей из файловой структуры для безопасности
* http сайты каждый раз, для https запоминает выбор
## Инструменты
* chrome
    * chrome://webrtc-logs/
    * chrome://webrtc-internals/
* opera
    * chrome://webrtc-internals/
* firefox
    * about:webrtc

* API 
    * ! Новое API navigator.mediaDevices 
        * https://developer.mozilla.org/ru/docs/Web/API/MediaDevices
    * getUserMedia 
        * constraint - у разных браузеров разное
            * audio 
            * video
            * какую камеру фронт/бек
            * fps
            * прочее

    * constraint
        * resolution https://webrtchacks.com/video-constraints-2/
        * 
    * получение устройств https://simpl.info/getusermedia/sources/